<!DOCTYPE html>
<html lang="en" class="bg-[#09090d] text-white overflow-x-hidden">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Auth - Dashboard</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdn.tailwindcss.com/3.3.5"></script>
</head>

<body class="bg-[#09090d] min-h-screen">
    <!-- Navigation -->
    <nav class="border-gray-200 px-4 lg:px-6 py-2.5">
        <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl">
            <a href="#" class="flex items-center">
                <span class="text-2xl font-semibold text-white">Private Auth</span>
            </a>
            <div class="flex items-center lg:order-2">
                <button id="logoutBtn" class="text-white focus:ring-0 font-medium rounded-lg text-sm px-4 py-2 lg:px-5 lg:py-2.5 mr-2 bg-red-600 hover:opacity-80 focus:outline-none focus:ring-red-800 transition duration-200">
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="flex">
        <!-- Sidebar Navigation -->
        <div class="w-64 bg-[#0f0f17] min-h-screen p-4">
            <div class="space-y-2">
                <a href="#licenses" onclick="showSection('licenses')" class="flex items-center p-3 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z" clip-rule="evenodd"></path>
                    </svg>
                    Licenses
                </a>
                <a href="#users" onclick="showSection('users')" class="flex items-center p-3 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                    </svg>
                    Users
                </a>
                <a href="settings.html" class="flex items-center p-3 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition duration-200">
                    <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                    </svg>
                    Settings
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <!-- Licenses Section -->
            <div id="licenses-section" class="section">
                <h1 class="text-3xl font-bold mb-8">Licenses Management</h1>
                
                <!-- Create License Form -->
                <div class="bg-[#0f0f17] rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Create New License</h2>
                    <form id="createLicenseForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">License Key</label>
                                <input type="text" id="licenseKey" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Auto-generated" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expiry Date</label>
                                <input type="datetime-local" id="expiryDate" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                            <input type="text" id="licenseDescription" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="License description">
                        </div>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                            Create License
                        </button>
                    </form>
                </div>

                <!-- Licenses List -->
                <div class="bg-[#0f0f17] rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Active Licenses</h2>
                    <div id="licensesList" class="space-y-2">
                        <!-- Licenses will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="section hidden">
                <h1 class="text-3xl font-bold mb-8">Users Management</h1>
                
                <!-- Create User Form -->
                <div class="bg-[#0f0f17] rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Create New User</h2>
                    <form id="createUserForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                                <input type="text" id="username" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                                <input type="password" id="password" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expiry Date</label>
                                <input type="datetime-local" id="userExpiryDate" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">License Key</label>
                                <select id="userLicenseKey" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500">
                                    <option value="">Select License</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                            Create User
                        </button>
                    </form>
                </div>

                <!-- Users List -->
                <div class="bg-[#0f0f17] rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Active Users</h2>
                    <div id="usersList" class="space-y-2">
                        <!-- Users will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAAN-l7ZRCMw8opvJWCZJAFXI5SM8k0vNs",
            authDomain: "our-auth-165db.firebaseapp.com",
            databaseURL: "https://our-auth-165db-default-rtdb.firebaseio.com",
            projectId: "our-auth-165db",
            storageBucket: "our-auth-165db.firebasestorage.app",
            messagingSenderId: "1064730108871",
            appId: "1:1064730108871:web:e3347d3ec217431f35efe2",
            measurementId: "G-KG1EEXQF51"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'inbex.html';
            }
        });

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName + '-section').classList.remove('hidden');
        }

        function generateLicenseKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 16; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        document.getElementById('licenseKey').value = generateLicenseKey();

        document.getElementById('createLicenseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const licenseKey = document.getElementById('licenseKey').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const description = document.getElementById('licenseDescription').value;
            
            try {
                const response = await fetch('https://api-s736.onrender.com/api/create_license', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        key: licenseKey,
                        expiry: expiryDate,
                        description: description
                    })
                });
                
                if (response.ok) {
                    alert('License created successfully!');
                    loadLicenses();
                    
                    document.getElementById('licenseKey').value = generateLicenseKey();
                    document.getElementById('expiryDate').value = '';
                    document.getElementById('licenseDescription').value = '';
                } else {
                    alert('Failed to create license. Please try again.');
                }
            } catch (error) {
                console.error('Error creating license:', error);
                alert('Error creating license. Please check your connection.');
            }
        });

        document.getElementById('createUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const expiryDate = document.getElementById('userExpiryDate').value;
            const licenseKey = document.getElementById('userLicenseKey').value;
            
            try {
                const response = await fetch('https://api-s736.onrender.com/api/create_user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                        expiry: expiryDate,
                        licenseKey: licenseKey
                    })
                });
                
                if (response.ok) {
                    alert('User created successfully!');
                    loadUsers();
                    
                    document.getElementById('createUserForm').reset();
                } else {
                    alert('Failed to create user. Please try again.');
                }
            } catch (error) {
                console.error('Error creating user:', error);
                alert('Error creating user. Please check your connection.');
            }
        });

        async function loadLicenses() {
            try {
                const response = await fetch('https://api-s736.onrender.com/api/get_licenses');
                const licenses = await response.json();
                const licensesList = document.getElementById('licensesList');
                
                if (licenses.length === 0) {
                    licensesList.innerHTML = '<p class="text-gray-400">No licenses created yet.</p>';
                    return;
                }
                
                licensesList.innerHTML = licenses.map(license => `
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-semibold">${license.key}</h3>
                                <p class="text-gray-400 text-sm">${license.description || 'No description'}</p>
                                <p class="text-gray-400 text-sm">Expires: ${new Date(license.expiry).toLocaleString()}</p>
                            </div>
                            <span class="px-2 py-1 bg-green-600 text-white text-xs rounded">${license.status}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading licenses:', error);
                document.getElementById('licensesList').innerHTML = '<p class="text-red-400">Error loading licenses. Please check your connection.</p>';
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('https://api-s736.onrender.com/api/get_users');
                const users = await response.json();
                const usersList = document.getElementById('usersList');
                
                if (users.length === 0) {
                    usersList.innerHTML = '<p class="text-gray-400">No users created yet.</p>';
                    return;
                }
                
                usersList.innerHTML = users.map(user => `
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-semibold">${user.username}</h3>
                                <p class="text-gray-400 text-sm">License: ${user.licenseKey}</p>
                                <p class="text-gray-400 text-sm">Expires: ${new Date(user.expiry).toLocaleString()}</p>
                            </div>
                            <span class="px-2 py-1 bg-green-600 text-white text-xs rounded">${user.status}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = '<p class="text-red-400">Error loading users. Please check your connection.</p>';
            }
        }

        async function loadLicenseOptions() {
            try {
                const response = await fetch('https://api-s736.onrender.com/api/get_licenses');
                const licenses = await response.json();
                const select = document.getElementById('userLicenseKey');
                
                select.innerHTML = '<option value="">Select License</option>' +
                    licenses.map(license => `<option value="${license.key}">${license.key}</option>`).join('');
            } catch (error) {
                console.error('Error loading license options:', error);
                document.getElementById('userLicenseKey').innerHTML = '<option value="">Error loading licenses</option>';
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'inbex.html';
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadLicenses();
            loadUsers();
            loadLicenseOptions();
        });
    </script>
</body>

</html>
